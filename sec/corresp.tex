\section{Correspondences}
\label{sec:corresp}
% \paragraph{Surface Correspondences: $\proj_\surface(\point)$}
Our correspondence search leverages the structure of \Eq{convsurf}, by decomposing the surface in several elementary convolution elements $\element$ (a decomposition of the shape in \todo{pill} and \todo{wedge} implicit primitives) and their associated implicit functions $\implicit_e$. Given a point $\point$ in space, the implicit function of the whole surface can be written by evaluating the expression:
\begin{equation}
\implicit_\surface(\point) = \argmin_{e=1 \dots E} \implicit_e(\point)
\label{eq:piecewise}
\end{equation}
Therefore, given a query point $\point$, we can first compute the closest-points $\footpoint_e = \proj_{\element}(\point)$ to each element independently; within this set, the closest-point projection to the full model $\footpoint = \proj_\surface(\point)$ is the one with the smallest associated implicit function value $\implicit_e(\point)$. In a tracking session with an average of \todo{1000 points/frame} the computation of closest-point correspondences takes \todo{300 $\mu s$/iteration}. We now describe in details how the projection is evaluated on each element in \todo{close form}. 

\input{fig/corresp/item.tex}
\paragraph{Pill Correspondences: $\footpoint=\proj_\text{pill}(\point)$}
A pill is defined by two balls $\ball_1(\ballcenter_1,r_1)$ and $\ball_2(\ballcenter_2,r_2)$. Let us first compute the position of the skewed projection $\skewproj$; see \Figure{corresp}-(left). 
% 
Let us assume $r_1 > r_2$ and define $\mathbf{u} = \ballcenter_2-\ballcenter_1$, $\mathbf{\vec{u}} = \mathbf{u}/\|\mathbf{u}\|$, $\mathbf{v} = \point-\ballcenter_1$, $\alpha=\mathbf{\vec{u}} \cdot \mathbf{v}$. The orthogonal projection of $\point$ onto the segment is $\mathbf{t} = \mathbf{c}_1 + \alpha \mathbf{u}$. The distance $\omega$ can be derived with the Pythagorean theorem as $\omega^2 = \mathbf{u}^T \mathbf{u} - (r_1 - r_2)^2$ while $\delta$ is derived leveraging triangle similarity $\delta / \| \point - \mathbf{t} \| = (r_1-r_2)/\omega$. Finally, our skewed projection $\skewproj$ is $\skewproj = \mathbf{t} - \delta \mathbf{\vec{u}}$.
% 
According to the position of $\skewproj$ we have two solutions: 
(1) If $\skewproj$ lies on the segment $\segment$, then $\point$ projects onto the pill's conic surface as $\footpoint=\mathbf{s}+(\gamma+r_2) \overrightarrow{\mathbf{\skewproj} \point}$, where $\overrightarrow{\skewproj \point} = (\point-\skewproj)/ \|\point-\skewproj\|$. 
(2) if $\skewproj$ lies outside the segment and closer to the ball $\ball_*$, then $\point$ projects onto the sphere as $\footpoint_e = \ballcenter_* + r_*(\overrightarrow{\point \ballcenter_*})$. \AT{this computation or explanation could be substantially simplified (in the writeup, don't worry for the code) in the same way as I did for the wedge}

\paragraph{Wedge Correspondences: $\footpoint=\proj_\text{wedge}(\point)$}
A wedge is defined by three spheres $\ball_i = \{\ballcenter_i, r_i\}$. By inspecting \Figure{convsurf}, it is apparent that a wedge element can be decomposed in three parts: \emph{spherical}, \emph{conical} and \emph{planar} elements respectively associated with vertices, edges and faces of the triangular convolution skeleton. Having identified the planar element $\mathcal{P}(\mathbf{n}, \mathbf{t}_0)$ with normal $\mathbf{n}$ and tangent $\mathbf{t}_0$ to $\ball_0$ (see \Appendix{wedgecorr}), we compute the skewed projection $\skewproj$ by finding the intersection of the ray $\mathbf{r}(t) = \point + t\mathbf{n}$ with the triangle $\mathcal{T}$ formed by $\ballcenter_1$, $\ballcenter_2$ and $\ballcenter_3$. 
% 
According to the position of $\skewproj$ we have two solutions:
(1) If the skewed $\skewproj$ lies inside the triangle $\mathcal{T}$, then our footpoint is $\footpoint = \proj_\mathcal{P}(\point)$, otherwise 
(2) employ the barycentric coordinates of $\skewproj$ in $\mathcal{T}$ to identify the closest pill element and compute $\footpoint=\proj_\text{pill}(\point)$.
